%!TEX root = main.tex
% these_classe.tex

\documentclass[11pt, draft, oneside]{report}
% \documentclass[11pt, oneside]{report}
% \setcounter{secnumdepth}{3}

\usepackage{xspace}
\usepackage[greek, french]{babel}                 % http://daniel.flipo.free.fr/frenchb/
\usepackage{appendix}
\usepackage[babel=true]{csquotes}                 % Ensure correct quote text
\frenchspacing                                    % French typo
\frenchbsetup{StandardLists=true}                 % Turn off french bulleted lists
\usepackage[dvipsnames, svgnames, table]{xcolor}  % Color support
\usepackage{./Template/graphics_support}          % Image support

\usepackage{bookmark}                      % load hyperref internaly
\hypersetup{
    pdfkeywords={Maison Passive,
                 Optimisation,
                 multi-critère,
                 multi-objectif,
                 analyse de sensibilité,
                 Dymola,
                 Modelica,
                 Solaire,
                 Système combiné},         % list of keywords
    unicode=true,                          % non-Latin characters in Acrobat’s bookmarks
    pdftoolbar=true,                       % show Acrobat’s toolbar?
    pdfmenubar=true,                       % show Acrobat’s menu?
    pdffitwindow=false,                    % window fit to page when opened
    pdfstartview={FitH},                   % fits the width of the page to the window
    pdftitle={Outil d’aide à la décision
              pour la construction de
              maison passives
              100\% solaires},             % title
    pdfauthor={Jérémy Bois},               % author
    pdfsubject={Optimisation,
                Solar combi-system,
                Maison passive},           % subject of the document
    pdfcreator={Jérémy Bois},              % creator of the document
    pdfproducer={Jérémy Bois},             % producer of the document
    pdfnewwindow=true,                     % links in new PDF window
    colorlinks=true,                       % false: boxed links; true: colored links
    linkcolor=SolarizedOrange,          % color of internal links (change box color with linkbordercolor)
    citecolor=SolarizedMagenta,         % color of links to bibliography
    filecolor=SolarizedMagenta,         % color of file links
    urlcolor=SolarizedBlue              % color of external links
}


% ------------------------------------------------------------------------------
% Template support
% ------------------------------------------------------------------------------
% \usepackage[sf]{titlesec}                         % Sans serif font for titles
\usepackage[Conny]{fncychap}                      % Fancy title
\usepackage{placeins}                                    % Float always where defined
\let\Oldsection\section
\renewcommand{\section}{\FloatBarrier\Oldsection}        % For section
\let\Oldsubsection\subsection
\renewcommand{\subsection}{\FloatBarrier\Oldsubsection}  % For subsection
% Template packages
\usepackage[top=2cm,
            bottom=2cm,
            left=2cm,
            right=3cm,
            a4paper]{geometry}             % Page layout support


% ------------------------------------------------------------------------------
% Math support
% ------------------------------------------------------------------------------
% \mathbf not working with xelatex better to use /bm with bm package (sometimes required {{\Gamma}})
\usepackage{siunitx}                                % Unit package
\usepackage{amsmath, amssymb, amsthm, mathtools,bm} % Allow adding complex equations
\usepackage{nicefrac}                               % for \nicefrac macro
% \usepackage{listings}                             % Code block support
\usepackage{letltxmacro}                            % Support for optional argument in redefinition



% ------------------------------------------------------------------------------
% Font support
% ------------------------------------------------------------------------------
\usepackage[math-style=french]{unicode-math}
\setmainfont{GandhiSerif-}[
Extension=.otf,
Path=./Fonts/,
UprightFont=*Regular,
BoldFont=*Bold,
ItalicFont=*Italic,
BoldItalicFont=*BoldItalic,
]  % Look nice

% \setsansfont{PT Sans}
\setsansfont{QuattrocentoSans-}[
Extension=.otf,
Path=./Fonts/,
UprightFont=*Regular,
BoldFont=*Bold,
ItalicFont=*Italic,
BoldItalicFont=*BoldItalic,
% Color=SolarizedBrBlack,
]

\setmathfont{Asana-Math}[
Path=./Fonts/,
Extension=.otf,
% Color=SolarizedBrBlack,
]

\defaultfontfeatures{Ligatures=TeX}


% ------------------------------------------------------------------------------
% Math config because math package must be load before unicode-math
% ------------------------------------------------------------------------------
\mathchardef\period=\mathcode`.                % Print a dot print as a dot no comma
\DeclareMathSymbol{.}{\mathord}{letters}{"3B}  % Decimal separator in math mode ...
\sisetup{output-decimal-marker={,}}            % ... and un siunitx: dot with comma
% Change the ways square root appears
\makeatletter
    \let\oldr@@t\r@@t
    \def\r@@t#1#2{%
    \setbox0=\hbox{$\oldr@@t#1{#2\,}$}\dimen0=\ht0
    \advance\dimen0-0.2\ht0
    \setbox2=\hbox{\vrule height\ht0 depth -\dimen0}%
    {\box0\lower0.7pt\box2}}
    \LetLtxMacro{\oldsqrt}{\sqrt}
    \renewcommand*{\sqrt}[2][\ ]{\oldsqrt[#1]{#2}}
\makeatother
\newcommand{\pluseq}{\mathrel{+}\mathrel{\mkern-1mu}=}  % Math symbols +=

% Mise en page des théorèmes
\usepackage{tikz}
\newsavebox{\boiteencadrement}
\newenvironment{encadrement}[1][gray!50]
  {\par\addvspace{\dimexpr\topsep+2pt}%
   \def\couleurencadrement{#1}%
   \begin{lrbox}{\boiteencadrement}%
   \begin{minipage}{\dimexpr\linewidth-2\fboxsep-2\fboxrule}%
  }
  {\end{minipage}\end{lrbox}%
   \noindent\begin{tikzpicture}[inner sep=\fboxsep+0.5em,line width=\fboxrule]
   \node[rounded corners,draw,color=black,fill=\couleurencadrement] {\usebox{\boiteencadrement}};
   \end{tikzpicture}%
   \par\addvspace{\topsep}%
  }
% Mise en page des Définitions
\newtheoremstyle{Def}
  {.5cm}               % Space before
  {.5cm}               % Space after
  {\itshape}           % Content style
  {\parindent}         % Title Indentation
  {\bfseries}          % Title style
  {}                   % Ponctuation after title and before title spacing
  {\newline}           % Space after Title
  {\thmname{#1}\thmnumber{ \textup{#2}}\thmnote{~(\textit{#3})}}   % Title construction
\theoremstyle{Def}
\newcounter{Def}
\newtheorem{preDef}[Def]{Définition}
\newenvironment{Def}{\begin{encadrement}[white]\begin{preDef}}{\end{preDef}\end{encadrement}}

% Circle arround text
\newcommand\encircle[1]{%
  \tikz[baseline=(X.base)]
    \node (X) [draw, shape=circle, inner sep=0] {\strut #1};}



% ------------------------------------------------------------------------------
% Algorithm support
% ------------------------------------------------------------------------------
\usepackage[french, onelanguage,
            linesnumbered, lined,
            boxed,
            commentsnumbered]{algorithm2e}


% Comments
\definecolor{commcolor}{HTML}{93a1a1}
\newcommand\commfont[1]{\footnotesize\ttfamily\textcolor{commcolor}{#1}}
\SetCommentSty{commfont}
\SetKwComment{AComment}{\#~}{}
% Functions
\SetKwFunction{ALevyFlight}{LevyFlight}
\SetKwFunction{ALevy}{Levy}
% Keywords
\SetKwData{ASources}{Sources}
\SetKwData{ASource}{Source}
\SetKwData{AButineuse}{Butineuse}
\SetKwData{AOuvriere}{Ouvrière}
\SetKwData{ANbrSources}{N}
\SetKwData{AOnlookers}{Ouvrières}
\SetKwData{AScouts}{Éclaireuses}
\SetKwData{AEmployed}{Butineuses}
\SetKwData{ABee}{Abeille}
\SetKwData{ABees}{Abeilles}
\SetKwData{AHive}{Essaim}
\SetKwData{AVariables}{Variables}
\SetKwData{AVariable}{Variable}
\SetKwData{ANbrVariables}{J}
\SetKwData{AArchive}{Archive}
\SetKwData{APopulation}{Population}
\SetKwData{ATirageA}{TirageA}
\SetKwData{ATirageB}{TirageB}
\SetKwData{ARatio}{Ratio}
\SetKwData{AMR}{MR}
\SetKwData{ATrial}{Echec}
\SetKwData{AMaxTrial}{MaxEchec}


% ------------------------------------------------------------------------------
% Notes support
% ------------------------------------------------------------------------------
\usepackage{soul}
\usepackage{xargs}                         % Use more than one optional parameter in a new commands
\usepackage[colorinlistoftodos,
            prependcaption,
            textsize=tiny]{todonotes}      % Note support

\makeatletter
% Redefine \missingfigure command from todonotes packages
    \renewcommand{\missingfigure}[2][]{%
    \setkeys{todonotes}{#1}%
    \addcontentsline{tdo}{todo}{%
        \fcolorbox{\@todonotes@currentbordercolor}%
        {\@todonotes@currentbackgroundcolor}%
        {\textcolor{\@todonotes@currentbackgroundcolor}{o}}%
        \ Figure: #2}%
    \par
    \noindent
    \begin{tikzpicture}
        \draw[fill=\@todonotes@currentfigcolor, draw = SolarizedBrGreen, line width=2pt]
             (-2, -2.5) rectangle +(\@todonotes@currentfigwidth, \@todonotes@currentfigheight);
        \draw (2, -1.5) node[right, text width=\@todonotes@currentfigwidth-4.5cm] {#2};
        \draw[SolarizedRed, fill=white, rounded corners = 5pt, line width=5pt]
             (-1.25,0) -- (1.25,0) -- (0,-2) -- cycle;
        \draw (0, -0.5) node[color=SolarizedBlack]{Figure};
    \end{tikzpicture}\hfill
    }% Ending \missingfigure command

% Define \missingequation command using \missingfigure command
    \newcommand{\missingequation}[2][]{%
    \setkeys{todonotes}{#1}%
    \addcontentsline{tdo}{todo}{%
        \fcolorbox{\@todonotes@currentbordercolor}%
        {\@todonotes@currentbackgroundcolor}%
        {\textcolor{\@todonotes@currentbackgroundcolor}{o}}%
        \ Equation: #2}%
    \par
    \par
    \noindent
    \begin{tikzpicture}
        \draw[fill=\@todonotes@currentfigcolor, draw = SolarizedBrGreen, line width=2pt]
             (-2, -2.5) rectangle +(\@todonotes@currentfigwidth, \@todonotes@currentfigheight);
        \draw (2, -1.5) node[right, text width=\@todonotes@currentfigwidth-4.5cm] {#2};
        \draw[SolarizedRed, fill=white, line width=5pt]
             (0,-0.3) circle (1.1cm);
        \draw (0, -0.4) node[color=SolarizedBlack]{Equation};
    \end{tikzpicture}\hfill
    }% Ending \missingequation command


% Define \missingtable command using \missingfigure command
    \newcommand{\missingtable}[2][]{%
    \setkeys{todonotes}{#1}%
    \addcontentsline{tdo}{todo}{%
        \fcolorbox{\@todonotes@currentbordercolor}%
        {\@todonotes@currentbackgroundcolor}%
        {\textcolor{\@todonotes@currentbackgroundcolor}{o}}%
        \ Table: #2}%
    \par
    \noindent
    \begin{tikzpicture}
        \draw[fill=\@todonotes@currentfigcolor, draw = SolarizedBrGreen, line width=2pt]
             (-2, -2.5) rectangle +(\@todonotes@currentfigwidth, \@todonotes@currentfigheight);
        \draw (2, -1.5) node[right, text width=\@todonotes@currentfigwidth-4.5cm, color=SolarizedBlack] {#2};
        \draw[SolarizedRed, fill=white, rounded corners = 5pt, line width=5pt]
             (-1, -1.5) rectangle (1, 0);
        \draw (0, -0.5) node[color=SolarizedBlack]{Table};
    \end{tikzpicture}\hfill
    }% Ending \missingtable command
\makeatother

% Note if not sure about that
\newcommandx{\munsure}[2][1=]{
    \todo[linecolor=SolarizedRed,
          backgroundcolor=SolarizedRed!40,
          bordercolor=SolarizedRed,
          #1]{?? \hfill #2 \hfill ??}}
\newcommandx{\iunsure}[2][1=]{
    \todo[linecolor=SolarizedRed,
          backgroundcolor=SolarizedRed!40,
          bordercolor=SolarizedRed,
          inline,
          size=\small,
          #1]{?? \hfill #2 \hfill ??}}

% Note with highlighted text
\newcommandx{\mfix}[3][1=]{
    \texthl{#3}%
    \todo[linecolor=SolarizedOrange,
          backgroundcolor=SolarizedOrange!80,
          bordercolor=SolarizedOrange,
          #1]{{!! \hfill #2 \hfill !!}}}
\newcommandx{\ifix}[2][1=]{
    \todo[linecolor=SolarizedOrange,
          backgroundcolor=SolarizedOrange!80,
          bordercolor=SolarizedOrange,
          inline,
          size=\small,
          #1]{{!! \hfill #2 \hfill !!}}}

% Note for part that need change
\newcommandx{\mtodo}[2][1=]{
    \todo[linecolor=SolarizedGreen,
          backgroundcolor=SolarizedGreen!40,
          bordercolor=SolarizedGreen,
          #1]{#2}}
\newcommandx{\itodo}[2][1=]{
    \todo[linecolor=SolarizedGreen,
          backgroundcolor=SolarizedGreen!40,
          bordercolor=SolarizedGreen,
          inline,
          size=\small,
          #1]{#2}}

% Note for missing figure
\newcommandx{\ftodo}[2][1=]{
    \missingfigure[figcolor=SolarizedViolet!25,
                   backgroundcolor=SolarizedViolet!25,
                   bordercolor=SolarizedViolet,
                   color=SolarizedViolet!25,
                   figheight=2cm,
                   size=\normalsize,
                   #1]{#2}}

% Note for missing equation
\newcommandx{\etodo}[2][1=]{
    \missingequation[figcolor=SolarizedCyan!25,
                     backgroundcolor=SolarizedCyan!25,
                     bordercolor=SolarizedCyan,
                     color=SolarizedCyan!25,
                     figheight=2cm,
                     size=\normalsize,
                     #1]{#2}}
\newcommandx{\emtodo}[2][1=]{
    \todo[linecolor=SolarizedCyan,
          backgroundcolor=SolarizedCyan!25,
          bordercolor=SolarizedCyan,
          #1]{Equation: #2}}

% Note for missing table
\newcommandx{\ttodo}[2][1=]{
    \missingtable[figcolor=SolarizedBlue!25,
                  backgroundcolor=SolarizedBlue!25,
                  bordercolor=SolarizedBlue,
                  color=SolarizedBlue!25,
                  figheight=2cm,
                  size=\normalsize,
                  #1]{#2}}


% ------------------------------------------------------------------------------
% Bibliography support
% ------------------------------------------------------------------------------
%   \parencite{bib_id}     Add parenthesis (Name, year)
%   \cite{bib_id}          Normal
%   \textcite{bib_id}      Dans une phrase
\usepackage[backend=biber,
            maxnames=2,             % Maximal number of name in citation
            minnames=1,             % Minimal number of name in citation
            style=authoryear-comp,  % Author only once if multiple + year
            sorting=nyt,            % Sort by name then year then title
            hyperref=true,          % Make citations as clickable links
            backref=true,           % Back reference to citation page in bibliography
            backrefstyle=none,      % Do not compress page list
            idemtracker=true,
            ]{biblatex}                                               % Bibliography support

\addbibresource{./Bibliographie/references.bib}                       % Where to find bibliography
\newcommand\mathplus{+}                                               % Weird stuff of biblatex

% Remove url for all first
\DeclareFieldFormat*{url}{}
\DeclareFieldFormat*{urldate}{}
% Cannot add url for techreport or electronic but I try and will works someday ...
\DeclareFieldFormat[techreport, electronic]{url}{\mkbibacro{URL}\addcolon\space\url{#1}}
\DeclareFieldFormat[article,periodical]{volume}{\mkbibparens{#1}}     % volume of a journal
\DeclareFieldFormat[article,incollection,inproceedings]{pages}{#1}    % no p. for articles

\AtEveryBibitem{%
  \clearfield{note}%
  \clearfield{owner}%
  \ifentrytype{article}{%
    \clearfield{issn}%
  }{}
}


% ------------------------------------------------------------------------------
% Nomenclature
% ------------------------------------------------------------------------------
\usepackage{nomencl}
\makenomenclature

% Add groups
\usepackage{etoolbox}
\renewcommand\nomgroup[1]{%
  \item[\bfseries
  \ifstrequal{#1}{A}{Abréviations}{%
  \ifstrequal{#1}{L}{Lettres latines}{%
  \ifstrequal{#1}{G}{Lettres grecques}{%
  \ifstrequal{#1}{I}{Indices}{}}}}%
]}

% Add units
\newcommand{\nomunit}[1]{%
\renewcommand{\nomentryend}{\hspace*{\fill}#1}}

% Add symbol on the left (default)
\renewcommand{\nomlabel}[1]{#1\hfil}


% ------------------------------------------------------------------------------
% Table support
% ------------------------------------------------------------------------------
% Add table support
\usepackage{booktabs}                             % Easy pro tables
\usepackage{multirow}                             % Multiple row
% \usepackage{longtable}                            % Allow to create tab on multiple pages
% \setlength{\LTcapwidth}{8in}                      % Change caption size

% New column type
\newcolumntype{C}[1]{>{\centering\arraybackslash}m{#1}}

% New table command to inser table inside a table cell
% \newcommand{\minitab}[2][Insert text here]{\begin{tabular}{#1}#2\end{tabular}}


% ------------------------------------------------------------------------------
% Modification when babel select french
% ------------------------------------------------------------------------------
\addto\captionsfrench{
  \renewcommand{\contentsname}{Sommaire}
  \renewcommand{\listfigurename}{Liste des Figures}
  \renewcommand{\listtablename}{Liste des Tableaux}
  \renewcommand{\appendixtocname}{Annexes}
  \renewcommand{\appendixpagename}{Annexes}
  \renewcommand{\appendixname}{Annexe}
}

% ------------------------------------------------------------------------------
% Solarized color definition
% ------------------------------------------------------------------------------
\definecolor{SolarizedBlue}{HTML}{268BD2}
\definecolor{SolarizedViolet}{HTML}{6c71c4}
\definecolor{SolarizedCyan}{HTML}{2aa198}
\definecolor{SolarizedMagenta}{HTML}{d33682}
\definecolor{SolarizedGreen}{HTML}{859900}
\definecolor{SolarizedRed}{HTML}{dc322f}
\definecolor{SolarizedYellow}{HTML}{b58900}
\definecolor{SolarizedOrange}{HTML}{cb4b16}

\definecolor{SolarizedBrWhite}{HTML}{fdf6e3}
\definecolor{SolarizedWhite}{HTML}{eee8d5}
\definecolor{SolarizedBrCyan}{HTML}{93a1a1}
\definecolor{SolarizedBrBlue}{HTML}{839496}
\definecolor{SolarizedBrYellow}{HTML}{657b83}
\definecolor{SolarizedBrGreen}{HTML}{586e75}
\definecolor{SolarizedBlack}{HTML}{073642}
\definecolor{SolarizedBrBlack}{HTML}{002b36}
